\ProvidesFile{MMservices.tex}[v1.0.0]
\primaryStart[ServicesAndTheirProtocols]{Services~and~Their~Protocols}
An \mplusm{} installation consists of a number of service applications and their companion
client applications, communicating via \mplusm{} requests and responses on a \yarp{}
network.\\

There is one special service, the \serviceNameR[Registry~Service]{RegistryService}, which
manages information about all other active services; all services register themselves
with the \serviceNameR[Registry~Service]{RegistryService} so that client applications and
utilities can get information about the service.\\

Other services can be, broadly, characterized as either \inputOutput{} services or normal
services.
\inputOutput{} services can be further divided into Input services, Output services and
Filter services.
Input services act as intermediaries between external data sources and the \mplusm{}
infrastructure, Output services act as intermediaries between an \mplusm{}
installation and external presentation systems and Filter services act as translators
between data formats.\\

\inputOutput{} services respond to a special set of requests, the
\secondaryRef{InputOutputRequests}{\inputOutput{}~Requests}, and have secondary \yarp{}
ports that provide access to the information that they process.
Input services have one or more secondary output \yarp{} network ports, Output services
have one or more secondary input \yarp{} network ports and Filter services have both
secondary input and output \yarp{} network ports.\\

Note that an Input service can also have secondary output \yarp{} network ports and an
Output service can also have secondary input \yarp{} network ports, but this is uncommon.

All services and clients utilize a request~/~response protocol that is defined by the
\mplusm{} \compLang{C++} core classes.\\

The standard requests are in 4 groups:
\begin{itemize}
\item \textbf{\secondaryRef{BasicRequests}{Basic~Requests:}} requests that support the
fundamental \mplusm{} service mechanisms
\item \textbf{\secondaryRef{RegistryServiceRequests}{Registry~Service~Requests:}} requests
that are specific to the \serviceNameR[Registry~Service]{RegistryService}
\item \textbf{\secondaryRef{InputOutputRequests}{\inputOutput{}~Requests:}} requests that
are specific to \inputOutput{} services
\item \textbf{\secondaryRef{MiscellaneousRequests}{Miscellaneous~Requests:}} other
requests
\end{itemize}
Requests are handled by derived classes of the base class for request handlers,
\secondaryRef{BaseRequestHandler}{BaseRequestHandler}.
Note that the \secondaryRef{BasicRequests}{Basic~Requests} are part of every service and
automatically supported in the base class of all services,
\secondaryRef{BaseService}{BaseService}.\\

When a client sends a request to a service, it can optionally request a response from the
service.
If no response is requested, the request is processed but no response is sent.
\secondaryStart[StandardServices]{Standard~Services}
There are two standard services that are always part of an \mplusm{} installation.
\utilityNameR{mpmRequestCounterService} and its companion application
\utilityNameR{mpmRequestCounterClient} are described elsewhere, and the
\serviceNameR[Registry~Service]{RegistryService} is described in the following section.
\tertiaryStart{mpmRegistryService (also known as the
\serviceNameD[Registry~Service]{RegistryService})}
The \serviceNameX[Registry~Service]{RegistryService} application is a background service
that is used to manage other services and their connections.
Its primary purpose is to serve as a repository of information on the active services in
an \mplusm{} installation.\\

It uses an internal database, as described in the
\appendixRef{InternalDatabaseStructure}{Internal~Database~Structure} appendix.
It responds to the requests in the
\secondaryRef{RegistryServiceRequests}{Registry~Service~Requests} group.\\

The application has two optional parameters:
\begin{itemize}
\item \textbf{-p:} specifies the port number to be used, if a non--default port is desired
\item \textbf{-r:} report the service metrics when the application exits
\end{itemize}
Note that only one copy of the \serviceNameX[Registry~Service]{RegistryService}
application can be running at a time in an \mplusm{} installation, due to its fixed
\yarp{} network port.\\

The \serviceNameX[Registry~Service]{RegistryService} application responds to a `HUP'
signal and will exit gracefully when one is sent to it.
\tertiaryEnd{\serviceNameE[Registry~Service]{RegistryService}}
\secondaryEnd{}
\secondaryStart[BasicRequests]{Basic~Requests}
These requests are implemented in all \mplusm{} services, via the
\secondaryRef{BaseService}{BaseService} class.
They constitute the fundamental mechanism that is used by the
\serviceNameR[Registry~Service]{RegistryService} to identify each active service.
\tertiaryStart{\requestsNameD{Basic}{Basic}{channels}}
The \requestsNameX{Basic}{Basic}{channels} request returns a list of the secondary input
channels and a list of the secondary output channels for its service.\\

It is used by the \utilityNameR{mpmServiceLister} and \emph{Channel Manager} utilities to
determine the active \yarp{} network connections for each service.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{channels}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{clients}, alias:\ %
\requestsNameD{Basic}{Basic}{c}}
The \requestsNameX{Basic}{Basic}{clients} request returns a list of the active clients of
its service, if the service has \yarp{} network connections with persistent state.\\

It is used by the \utilityNameR{mpmClientList} utility to display a list of the clients
of services that have \yarp{} network connections with state.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{clients}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{detach}}
The \requestsNameX{Basic}{Basic}{detach} request is used by clients of a service to
indicate that they are no longer actively communicating with the service.\\

It is used by all client applications and adapters, such as
\examplesNameR{Clients}{mpmEchoClient},
\examplesNameR{Adapters}{mpmRandomNumberAdapter},\\
\examplesNameR{Clients}{mpmRandomNumberClient}, \utilityNameR{mpmRequestCounterClient},
\examplesNameR{Adapters}{mpmRunningSumAdapter},
\examplesNameR{Adapters}{mpmRunningSumAltAdapter} and
\examplesNameR{Clients}{mpmRunningSumClient}, to cleanly disconnect from their
corresponding service.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{detach}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{getMetrics}}
The \requestsNameX{Basic}{Basic}{getMetrics} request returns measurements of the channels
associated with a service.
The measurements include the number of bytes and the number of messages sent and
received on each channel.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{getMetrics}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{getMetricsState}}
The \requestsNameX{Basic}{Basic}{getMetricsState} request returns the state of the metrics
collection for the service, with \asCode{0} indicating that the metrics collection is
disabled and \asCode{1} indicating that it is enabled.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{getMetricsState}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{info}}
The \requestsNameX{Basic}{Basic}{info} request returns details about a single request
handled by a service.
The request details include the standard name of the request, the version number of the
request handler for the request, search keywords that can be used when matching requests,
a description of the request as well as representations of the expected arguments for the
request and output of the request.\\

It is used by the \utilityNameR{mpmRequestInfo} utility to gather information about a
request available from an active service.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{info}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{list}, alias:\ %
\requestsNameD{Basic}{Basic}{l}}
The \requestsNameX{Basic}{Basic}{list} request returns details about one or more requests
handled by a service.
The request details include the standard name of the request, the version number of the
request handler for the request, search keywords that can be used when matching requests,
a description of the request as well as representations of the expected arguments for the
request and output of the request.\\

It is used by the \serviceNameR[Registry~Service]{RegistryService} and the
\utilityNameR{mpmRequestInfo} utility to gather information about the requests available
from each active service.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{list}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{name}, alias:\ %
\requestsNameD{Basic}{Basic}{n}}
The \requestsNameX{Basic}{Basic}{name} request returns details about its service, in the
form of the canonical name of the service, its description, its kind, the path to the
executable for the service and a description of the requests for the service.\\

It is used by the \serviceNameR[Registry~Service]{RegistryService} and the
\utilityNameR{mpmServiceLister} and \emph{Channel Manager} utilities to collect basic
information about each service.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{name}}
\tertiaryStart{\requestsNameD{Basic}{Basic}{setMetricsState}}
The \requestsNameX{Basic}{Basic}{setMetricsState} request sets the state of the metrics
collection for the service, with \asCode{0} indicating that the metrics collection is
to be disabled and \asCode{1} indicating that it is to be enabled.
\tertiaryEnd{\requestsNameE{Basic}{Basic}{setMetricsState}}
\secondaryEnd{}
\secondaryStart[RegistryServiceRequests]{Registry~Service~Requests}
The requests in this group are used exclusively by the
\serviceNameR[Registry~Service]{RegistryService} application to manage its internal
database and to respond to information requests from client applications.
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{associate}}
The \requestsNameX{Registry~Service}{RegistryService}{associate} request is sent by
adapter applications to indicate that a particular \yarp{} network connection is part of
the same process as the client connection that sent the request.\\

It is used by the adapter applications \examplesNameR{Adapters}{mpmRandomNumberAdapter},
\examplesNameR{Adapters}{mpmRunningSumAdapter} and\\
\examplesNameR{Adapters}{mpmRunningSumAltAdapter} to indicate the input and output
\yarp{} network connections that are part of the application.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{associate}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{disassociate}}
The \requestsNameX{Registry~Service}{RegistryService}{disassociate} request is sent by
adapter applications to indicate that a particular \yarp{} network connection is no
longer part of the same process as the client connection that sent the request.
This is normally done as part of the shutdown process for the application.\\

It is used by the adapter applications \examplesNameR{Adapters}{mpmRandomNumberAdapter},
\examplesNameR{Adapters}{mpmRunningSumAdapter} and\\
\examplesNameR{Adapters}{mpmRunningSumAltAdapter} to indicate that all the input and
output \yarp{} network connections that are part of the application are no longer active.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{disassociate}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{getAssociates}}
The \requestsNameX{Registry~Service}{RegistryService}{getAssociates} request returns
a list of the input \yarp{} network connections and a list of the output \yarp{} network
connections for a given connection; if the requested port corresponds to a secondary
\yarp{} network connection, then the request returns the client connection that it is
associated with.\\

It is used by the \utilityNameR{mpmPortLister} and \emph{Channel Manager} utilities to
identify relationships between \yarp{} network connections.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{getAssociates}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{match}, alias:\ %
\requestsNameD{Registry~Service}{RegistryService}{find}}
The \requestsNameX{Registry~Service}{RegistryService}{match} request returns a list of
input \yarp{} network connections or service names for services that match the criteria
provided as an argument to the request.\\

It is used by all client and adapter applications to identify the service to which they
need to connect as well as by the \utilityNameR{mpmClientList},
\utilityNameR{mpmPortLister}, \utilityNameR{mpmRequestInfo},
\utilityNameR{mpmServiceLister} and \emph{Channel Manager} utilities to identify services
in order to gather information about them.\\

For details on the syntax used with the criteria, see the 
\appendixRef{ServiceMatchSyntax}{Service~Match~Syntax} appendix.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{match}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{ping}}
The \requestsNameX{Registry~Service}{RegistryService}{ping} request is sent by each
active service (except the \serviceNameR[Registry~Service]{RegistryService}) to indicate
that it is still `alive'.\\

Sending a \requestsNameX{Registry~Service}{RegistryService}{ping} request results in a
sequence of requests being sent from the \serviceNameR[Registry~Service]{RegistryService}
to the active service if the information on the service is no longer in the internal
database.
This will happen if the service is considered to be `stale' -- it has not sent a
\requestsNameX{Registry~Service}{RegistryService}{ping} request often enough to be
remembered.
The sequence of requests sent to the active service is described in the 
\appendixRef{RegistrationSequence}{Registration~Sequence} appendix.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{ping}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{register}, alias:\ %
\requestsNameD{Registry~Service}{RegistryService}{remember}}
The \requestsNameX{Registry~Service}{RegistryService}{register} request is sent by each
active service (except the \serviceNameR[Registry~Service]{RegistryService}) when it
starts execution.\\

Sending a \requestsNameX{Registry~Service}{RegistryService}{register} request results in a
sequence of requests being sent from the \serviceNameR[Registry~Service]{RegistryService}
to the active service.
The sequence of requests sent to the active service is described in the 
\appendixRef{RegistrationSequence}{Registration~Sequence} appendix.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{register}}
\tertiaryStart{\requestsNameD{Registry~Service}{RegistryService}{unregister}, alias:\ %
\requestsNameD{Registry~Service}{RegistryService}{forget}}
The \requestsNameX{Registry~Service}{RegistryService}{unregister} request is sent by each
service (except the \serviceNameR[Registry~Service]{RegistryService}) just before it stops
execution.\\

Upon receiving the \requestsNameX{Registry~Service}{RegistryService}{unregister} request,
the \serviceNameR[Registry~Service]{RegistryService} removes all entries from the internal
database that are related to the service being removed.
\tertiaryEnd{\requestsNameE{Registry~Service}{RegistryService}{unregister}}
\secondaryEnd{}
\secondaryStart[InputOutputRequests]{\inputOutput{}~Requests}
These requests are implemented in all \mplusm{} \inputOutput{} services, via the
\secondaryRef{BaseInputOutputService}{BaseInputOutputService} class.
\tertiaryStart{\requestsNameD{\inputOutput{}}{InputOutput}{configure}}
The \requestsNameX{\inputOutput{}}{InputOutput}{configure} request is available for
\inputOutput{} services that require special setup information, such as a device
identifier or file--system path.
It is the responsibility of derived classes of the
\secondaryRef{BaseInputOutputService}{BaseInputOutputService} class to provide a method
that handles the data provided in the
\requestsNameX{\inputOutput{}}{InputOutput}{configure} request.\\

For the \examplesNameR{Services}{mpmRandomBurstService} application, the configuration
data consists of a floating--point number (the burst period) and an integer (the burst
size); for the \examplesNameR{Services}{mpmRecordIntegersService} application, the
configuration data consists of the file--system path for the service output file.\\

\requestsNameX{\inputOutput{}}{InputOutput}{configure} requests should be sent by
client applications before sending
\requestsNameR{\inputOutput{}}{InputOutput}{startStreams} requests.
\tertiaryEnd{\requestsNameE{\inputOutput{}}{InputOutput}{configure}}
\tertiaryStart{\requestsNameD{\inputOutput{}}{InputOutput}{restartStreams}}
The \requestsNameX{\inputOutput{}}{InputOutput}{restartStreams} request allows client
applications to `rewind' all input and output streams, if this is a meaningful operation.
It is roughly equivalent to a \requestsNameR{\inputOutput{}}{InputOutput}{stopStreams}
request followed by a \requestsNameR{\inputOutput{}}{InputOutput}{startStreams} request,
but it may perform some extra work between the two requests.
\tertiaryEnd{\requestsNameE{\inputOutput{}}{InputOutput}{restartStreams}}
\tertiaryStart{\requestsNameD{\inputOutput{}}{InputOutput}{startStreams}}
The \requestsNameX{\inputOutput{}}{InputOutput}{startStreams} request initiates activity
on the input and output ports associated with an \inputOutput{} service.
That is, for Input services, data will now be sent out the output \yarp{} network ports,
for Output services, data will be processed from the input \yarp{} network ports and, for
Filter services, data will flow from the input \yarp{} network ports to the output \yarp{}
network ports.\\

Note that an Output service can be `always on', as it can defer the external
representation of its input data until the first data arrives at its input \yarp{}
network port.\\

For the \examplesNameR{Services}{mpmRandomBurstService} application, starting the
streams corresponds to initiating an asynchronous random number generator; for the
\examplesNameR{Services}{mpmRecordIntegersService} application, starting the streams
involves opening the service output file and for the
\examplesNameR{Services}{mpmTruncateFloatService} application, starting the streams
simply allows data to flow through.
\tertiaryEnd{\requestsNameE{\inputOutput{}}{InputOutput}{startStreams}}
\tertiaryStart{\requestsNameD{\inputOutput{}}{InputOutput}{stopStreams}}
The \requestsNameX{\inputOutput{}}{InputOutput}{stopStreams} request stops activity on
the input and output ports associated with an \inputOutput{} service.
That is, for Input services, data will no longer be sent out the output \yarp{} network
ports, for Output services, data from the input \yarp{} network ports will be ignored and,
for Filter services, data will no longer flow from the input \yarp{} network ports to the
output \yarp{} network ports.\\

Note that an `always on' Output service can ignore
\requestsNameX{\inputOutput{}}{InputOutput}{stopStreams} requests, if the external
representation of its input data is not affected by the lack of input data.
\tertiaryEnd{\requestsNameE{\inputOutput{}}{InputOutput}{stopStreams}}
\secondaryEnd{}
\secondaryStart[MiscellaneousRequests]{Miscellaneous~Requests}
Requests in this group are used with the \utilityNameR{mpmRequestCounterClient} client
application and \utilityNameR{mpmRequestCounterService} application or are requests that
are common.
\tertiaryStart{\requestsNameD{Miscellaneous}{Miscellaneous}{echo}}
The \requestsNameX{Miscellaneous}{Miscellaneous}{echo} request simply returns whatever
as provided as arguments to the request.
It is used by the unit testing framework of \mplusm{} to provide a simple request that
can be validated, as well as by the \examplesNameR{Clients}{mpmEchoClient} application
and \examplesNameR{Services}{mpmEchoService} application to implement an `echo' mechanism.
\tertiaryEnd{\requestsNameE{Miscellaneous}{Miscellaneous}{echo}}
\tertiaryStart{\requestsNameD{Miscellaneous}{Miscellaneous}{resetcounter}}
The \requestsNameX{Miscellaneous}{Miscellaneous}{resetcounter} request is used by the
\utilityNameR{mpmRequestCounterClient} application to request that the
\utilityNameR{mpmRequestCounterService} application is to clear its request counter and
elapsed time data.
\tertiaryEnd{\requestsNameE{Miscellaneous}{Miscellaneous}{resetcounter}}
\tertiaryStart{\requestsNameD{Miscellaneous}{Miscellaneous}{stats}}
The \requestsNameX{Miscellaneous}{Miscellaneous}{stats} request is used by the
\utilityNameR{mpmRequestCounterClient} application to retrieve the request counter and
elapsed time data from the \utilityNameR{mpmRequestCounterService} application.
\tertiaryEnd{\requestsNameE{Miscellaneous}{Miscellaneous}{stats}}
\secondaryEnd{}
\primaryEnd{}
